{"ast":null,"code":"import { catchError, switchMap, throwError } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class AuthInterceptor {\n  constructor(http) {\n    this.http = http;\n    this.refresh = false;\n  }\n  intercept(request, next) {\n    const req = request.clone({\n      setHeaders: {\n        Authorization: `Bearer ${AuthInterceptor.accessToken}`\n      }\n    });\n    return next.handle(req).pipe(catchError(err => {\n      if (err.status === 401 && !this.refresh) {\n        this.refresh = true;\n        return this.http.post('http://localhost:8000/api/refresh', {}, {\n          withCredentials: true\n        }).pipe(switchMap(res => {\n          AuthInterceptor.accessToken = res.token;\n          return next.handle(request.clone({\n            setHeaders: {\n              Authorization: `Bearer ${AuthInterceptor.accessToken}`\n            }\n          }));\n        }));\n      }\n      this.refresh = false;\n      return throwError(() => err);\n    }));\n  }\n}\nAuthInterceptor.accessToken = '';\nAuthInterceptor.ɵfac = function AuthInterceptor_Factory(t) {\n  return new (t || AuthInterceptor)(i0.ɵɵinject(i1.HttpClient));\n};\nAuthInterceptor.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthInterceptor,\n  factory: AuthInterceptor.ɵfac\n});","map":{"version":3,"mappings":"AAOA,SAASA,UAAU,EAAcC,SAAS,EAAEC,UAAU,QAAQ,MAAM;;;AAGpE,OAAM,MAAOC,eAAe;EAI1BC,YAAoBC,IAAgB;IAAhB,SAAI,GAAJA,IAAI;IAFxB,YAAO,GAAG,KAAK;EAGf;EAEAC,SAAS,CAACC,OAA6B,EAAEC,IAAiB;IACxD,MAAMC,GAAG,GAAGF,OAAO,CAACG,KAAK,CAAC;MACxBC,UAAU,EAAE;QACVC,aAAa,EAAE,UAAUT,eAAe,CAACU,WAAW;;KAEvD,CAAC;IAEF,OAAOL,IAAI,CAACM,MAAM,CAACL,GAAG,CAAC,CAACM,IAAI,CAACf,UAAU,CAAEgB,GAAsB,IAAI;MACjE,IAAIA,GAAG,CAACC,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAACC,OAAO,EAAE;QACvC,IAAI,CAACA,OAAO,GAAG,IAAI;QAEnB,OAAO,IAAI,CAACb,IAAI,CAACc,IAAI,CAAC,mCAAmC,EAAE,EAAE,EAAE;UAAEC,eAAe,EAAE;QAAI,CAAE,CAAC,CAACL,IAAI,CAC5Fd,SAAS,CAAEoB,GAAQ,IAAI;UACrBlB,eAAe,CAACU,WAAW,GAAGQ,GAAG,CAACC,KAAK;UAEvC,OAAOd,IAAI,CAACM,MAAM,CAACP,OAAO,CAACG,KAAK,CAAC;YAC/BC,UAAU,EAAE;cACVC,aAAa,EAAE,UAAUT,eAAe,CAACU,WAAW;;WAEvD,CAAC,CAAC;QACL,CAAC,CAAC,CACH;;MAEH,IAAI,CAACK,OAAO,GAAG,KAAK;MACpB,OAAOhB,UAAU,CAAC,MAAMc,GAAG,CAAC;IAC9B,CAAC,CAAC,CAAC;EACL;;AAjCWb,eAAe,CACnBU,WAAW,GAAG,EAAE;AADZV,eAAe;mBAAfA,eAAe;AAAA;AAAfA,eAAe;SAAfA,eAAe;EAAAoB,SAAfpB,eAAe;AAAA","names":["catchError","switchMap","throwError","AuthInterceptor","constructor","http","intercept","request","next","req","clone","setHeaders","Authorization","accessToken","handle","pipe","err","status","refresh","post","withCredentials","res","token","factory"],"sourceRoot":"","sources":["C:\\Users\\Asus\\Documents\\GitHub\\CarManagementClient\\src\\app\\inceptor\\auth.interceptor.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpRequest,\r\n  HttpHandler,\r\n  HttpEvent,\r\n  HttpInterceptor, HttpErrorResponse, HttpClient\r\n} from '@angular/common/http';\r\nimport { catchError, Observable, switchMap, throwError } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class AuthInterceptor implements HttpInterceptor {\r\n  static accessToken = '';\r\n  refresh = false;\r\n\r\n  constructor(private http: HttpClient) {\r\n  }\r\n\r\n  intercept(request: HttpRequest<unknown>, next: HttpHandler): Observable<HttpEvent<unknown>> {\r\n    const req = request.clone({\r\n      setHeaders: {\r\n        Authorization: `Bearer ${AuthInterceptor.accessToken}`\r\n      }\r\n    });\r\n\r\n    return next.handle(req).pipe(catchError((err: HttpErrorResponse) => {\r\n      if (err.status === 401 && !this.refresh) {\r\n        this.refresh = true;\r\n\r\n        return this.http.post('http://localhost:8000/api/refresh', {}, { withCredentials: true }).pipe(\r\n          switchMap((res: any) => {\r\n            AuthInterceptor.accessToken = res.token;\r\n\r\n            return next.handle(request.clone({\r\n              setHeaders: {\r\n                Authorization: `Bearer ${AuthInterceptor.accessToken}`\r\n              }\r\n            }));\r\n          })\r\n        );\r\n      }\r\n      this.refresh = false;\r\n      return throwError(() => err);\r\n    }));\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}